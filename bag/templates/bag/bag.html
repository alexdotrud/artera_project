{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="d-flex align-items-center justify-content-center py-5" style="min-height: 75vh;">
    <div class="container mb-4 bag">
        <div class="row">
            <div class="col">
                <h1 class="mb-4">Shopping Bag</h2>
            </div>
        </div>

        <div class="row">
            <div class="col">
                {% if bag_items %}
                <div class="table-responsive table-borderless">
                    <table class="table rounded mt-2 mb-4">
                        <thead class="text-black">
                            <tr>
                                <th scope="col"></th>
                                <th scope="col">Product Info</th>
                                <th scope="col">Price</th>
                                <th scope="col">Quantity</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for it in bag_items %}
                            <tr>
                                <td class="p-3 w-25">
                                    {% if it.artwork.image %}
                                    <a href="{% url 'detail' it.artwork.id %}">
                                        <img class="img-fluid" src="{{ it.artwork.image.url }}"
                                            alt="{{ it.artwork.name }}">
                                    </a>
                                    {% elif it.artwork.image_url %}
                                    <a href="{% url 'detail' it.artwork.id %}">
                                        <img class="img-fluid" src="{{ it.artwork.image_url }}"
                                            alt="{{ it.artwork.name }}">
                                    </a>
                                    {% else %}
                                    <img class="img-fluid" src="{% static 'images/no-image.jpg' %}"
                                        alt="{{ it.artwork.name }}">
                                    {% endif %}
                                </td>

                                <!-- Product info -->
                                <td class="py-3">
                                    <p class="my-0">
                                        <a href="{% url 'detail' it.artwork.id %}"
                                            class="text-decoration-none text-dark">
                                            {{ it.artwork.name }}
                                        </a>
                                    </p>
                                    <p class="my-0"><strong>Size:</strong> {{ it.size|upper }}</p>
                                    {% if it.artwork.sku %}
                                    <p class="my-0 small text-muted">SKU: {{ it.artwork.sku|upper }}</p>
                                    {% endif %}
                                </td>

                                <!-- Unit price -->
                                <td class="py-3">
                                    <p>
                                        ${{ it.price|default:it.artwork.price|floatformat:2 }}
                                    </p>
                                </td>
                                <!-- Quantity (fixed to 1) + remove -->
                                <td class="py-3">
                                    <p class="mb-1">1</p>
                                </td>
                                <td class="py-3">
                                    <form method="post" action="{% url 'remove_from_bag' it.item_id %}">
                                        {% csrf_token %}
                                        {% if it.size %}
                                        <input type="hidden" name="product_size" value="{{ it.size }}">
                                        {% endif %}
                                        <button type="submit" class="btn remove-item">Remove</button>
                                    </form>
                                </td>
                                {% endfor %}
                            </tr>
                        </tbody>

                        <tfoot class="align-bottom">
                            <tr>
                                <th colspan="3"></th>
                                <th class="text-end pt-4">Delivery:</th>
                                <th class="text-start pt-4">
                                    {% if delivery > 0 %}
                                    ${{ delivery|floatformat:2 }}
                                    {% else %}
                                    <span class="text-success">Free</span>
                                    {% endif %}
                                </th>
                            </tr>
                            <tr>
                                <th colspan="3"></th>
                                <th class="text-end pb-3 fw-bold">Total:</th>
                                <th class="text-start pb-3 fw-bold">
                                    ${{ grand_total|default:total|floatformat:2 }}
                                </th>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="d-flex gap-2 ">
                    <a href="{% url 'all_artworks' %}" class="btn btn-outline-dark">Keep Shopping</a>
                    <a href="{% url 'checkout' %}" class="btn btn-dark">Secure Checkout</a>
                </div>
                {% else %}
                <div class="empty">
                    <p class="lead mb-4">Your bag is empty.</p>
                    <a href="{% url 'all_artworks' %}" class="btn btn-dark">Shop Now</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}